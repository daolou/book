# Docker

## what is docker

- æ ¹æ®å®˜ç½‘æè¿°ï¼Œ[docker](https://www.docker.com/why-docker) æ˜¯ä¸€ä¸ªå®¹å™¨å¹³å°ï¼Œæ˜¯æ ‡å‡†åŒ–çš„è½¯ä»¶å•å…ƒï¼Œä½¿ç”¨äº†è™šæ‹ŸåŒ–æŠ€æœ¯ï¼ˆ[cgroup](https://access.redhat.com/documentation/zh-cn/red_hat_enterprise_linux/6/html/resource_management_guide/ch01)ï¼šæä¾›å®¹å™¨éš”ç¦»ï¼›[UnionFS](http://unionfs.filesystems.org/)ï¼šä¿å­˜é•œåƒå¹¶ä½¿å®¹å™¨å˜å¾—çŸ­æš‚ï¼‰ï¼ŒåŸºäº Google æ¨å‡ºçš„ go è¯­è¨€å®ç°çš„å¼€æºé¡¹ç›®ï¼Œä»£ç åœ¨ [GitHub](https://github.com/docker/docker) ä¸Šè¿›è¡Œç»´æŠ¤ã€‚

## why use docker

- å¿«é€Ÿäº¤ä»˜å’Œéƒ¨ç½²
  - è½»å¿«ï¼šä¸€æ¬¡åˆ›å»ºæˆ–é…ç½®ï¼Œå¯åœ¨ä»»æ„åœ°æ–¹æ­£å¸¸è¿è¡Œï¼Œç§’çº§å¯åŠ¨ï¼ŒèŠ‚çº¦å¼€å‘ã€æµ‹è¯•ã€éƒ¨ç½²æ—¶é—´ã€‚
- é«˜æ•ˆè™šæ‹ŸåŒ–
  - åŸºäºå†…æ ¸çš„è™šæ‹ŸåŒ–ï¼Œä¸éœ€è¦é¢å¤– hypervisor æ”¯æŒï¼ŒCPU/å†…å­˜çš„ä½æ¶ˆè€—ï¼Œæ›´é«˜æ•ˆã€‚
- å¯ç§»æ¤ã€å¯æ‰©å±•
  - ç‰©ç†æœºã€è™šæ‹Ÿæœºã€å…¬æœ‰äº‘ã€ç§æœ‰äº‘ã€ä¸ªäººç”µè„‘ã€æœåŠ¡å™¨ç­‰å¹³å°å‡å¯ä»¥è¿è¡Œ
- å¯¹æ¯”ä¼ ç»Ÿè™šæ‹Ÿæœº

  |    ç‰¹æ€§    |      å®¹å™¨      |   è™šæ‹Ÿæœº   |
  | :--------: | :------------: | :--------: |
  |    å¯åŠ¨    |      ç§’çº§      |   åˆ†é’Ÿçº§   |
  |  ç¡¬ç›˜ä½¿ç”¨  |    ä¸€èˆ¬ MB     |  ä¸€èˆ¬ GB   |
  |    æ€§èƒ½    |    æ¥è¿‘åŸç”Ÿ    |  å¼±äºåŸç”Ÿ  |
  | ç³»ç»Ÿæ”¯æŒé‡ | å•æœºä¸Šåƒä¸ªå®¹å™¨ | ä¸€èˆ¬å‡ åä¸ª |

  ![compare](https://user-gold-cdn.xitu.io/2019/4/28/16a6309c3f0b7fcf?w=1331&h=563&f=jpeg&s=100521)

- å¯ä»¥æ€»ç»“å‡ºï¼Œdocker å¯ä»¥å®ç°ï¼š
  - éš”ç¦»åº”ç”¨ä¾èµ–
  - åˆ›å»ºåº”ç”¨é•œåƒå¹¶è¿›è¡Œå¤åˆ¶
  - åˆ›å»ºæ˜“åˆ†å‘çš„å³å¯å³ç”¨çš„åº”ç”¨
  - å…è®¸å®ä¾‹ç®€å•ã€å¿«é€Ÿæ‰©å±•
  - æµ‹è¯•åº”ç”¨å¹¶éšåé”€æ¯

> å¯è§ docker çš„ **é‡å¿ƒ** æ˜¯åˆ›å»º ===è½¯ä»¶ç¨‹åºå¯ç§»æ¤çš„è½»é‡å®¹å™¨===ï¼Œè®©å…¶å¯ä»¥åœ¨ä»»ä½•å®‰è£…äº† docker çš„æœºå™¨ä¸Šè¿è¡Œï¼Œè€Œä¸ç”¨å…³å¿ƒåº•å±‚æ“ä½œç³»ç»Ÿã€‚

## how to use docker

å…ˆäº†è§£ä¸€ä¸‹å‡ ä¸ªåŸºæœ¬æ¦‚å¿µï¼š

> **é•œåƒ**ï¼šæ˜¯ä¸€ä¸ªåªè¯»çš„æ¨¡ç‰ˆï¼Œç”¨æ¥åˆ›å»º docker å®¹å™¨ï¼Œå®¹å™¨åœ¨å¯åŠ¨çš„æ—¶å€™åˆ›å»ºä¸€å±‚å¯å†™å±‚ä½œä¸ºæœ€ä¸Šå±‚

---

> **å®¹å™¨**ï¼šä»é•œåƒåˆ›å»ºçš„è¿è¡Œå®ä¾‹ï¼Œå¯ä»¥è¢«å¯åŠ¨ã€å¼€å§‹ã€åœæ­¢ã€åˆ é™¤ã€‚å®¹å™¨é—´æ˜¯ç›¸äº’éš”ç¦»çš„ï¼Œçœ‹ä¸Šå»æ˜¯ä¸€ä¸ªç®€æ˜“ç‰ˆçš„ Linux ç¯å¢ƒï¼ˆåŒ…æ‹¬ root ç”¨æˆ·æƒé™ã€è¿›ç¨‹ç©ºé—´ã€ç”¨æˆ·ç©ºé—´å’Œç½‘ç»œç©ºé—´ç­‰ï¼‰å’Œè¿è¡Œåœ¨å…¶ä¸­çš„åº”ç”¨ç¨‹åº

---

> **ä»“åº“**ï¼šç±»ä¼¼ gitï¼Œé›†ä¸­å­˜æ”¾é•œåƒæ–‡ä»¶çš„åœºæ‰€ï¼Œåˆ†ä¸ºå…¬å¼€ä»“åº“ï¼ˆPublicï¼‰å’Œç§æœ‰ä»“åº“ï¼ˆPrivateï¼‰ï¼Œæœ€å¤§çš„å…¬å¼€ä»“åº“æ˜¯ [Docker Hub](https://hub.docker.com/)

---

> **æ³¨å†ŒæœåŠ¡å™¨**ï¼šç±»ä¼¼ GitHub è¿™æ ·çš„æ‰˜ç®¡æœåŠ¡ï¼Œå­˜æ”¾ç€å¤šä¸ªä»“åº“

---

> **å®¿ä¸»æœº**ï¼šdocker æ‰€åœ¨çš„æœåŠ¡å™¨

---

> **æ•°æ®å·**ï¼šå¯ä¾›ä¸€ä¸ªæˆ–å¤šä¸ªå®¹å™¨ä½¿ç”¨çš„ç‰¹æ®Šç›®å½•ï¼Œç±»ä¼¼äº Linux ä¸‹å¯¹ç›®å½•æˆ–æ–‡ä»¶è¿›è¡Œ mountï¼Œå®ƒç»•è¿‡ UFSï¼Œå¯ä»¥æä¾›å¾ˆå¤šæœ‰ç”¨çš„ç‰¹æ€§ï¼š
>
> - åœ¨å®¹å™¨ä¹‹é—´å…±äº«å’Œé‡ç”¨
> - å¯¹æ•°æ®å·çš„ä¿®æ”¹ä¼šç«‹é©¬ç”Ÿæ•ˆ
> - å¯¹æ•°æ®å·çš„æ›´æ–°ï¼Œä¸ä¼šå½±å“é•œåƒ
> - å·ä¼šä¸€ç›´å­˜åœ¨ï¼Œç›´åˆ°æ²¡æœ‰å®¹å™¨ä½¿ç”¨

---

> **ç½‘ç»œæ¨¡å¼**ï¼šç”¨æ¥å®ç°å®¹å™¨çš„ç½‘ç»œé€šä¿¡ï¼Œå¤§æ¦‚åŒ…æ‹¬äº”ç§ï¼š
>
> - bridge æ¨¡å¼ï¼Œ--net=bridge(é»˜è®¤)
> - host æ¨¡å¼ï¼Œ--net=host
> - none æ¨¡å¼ï¼Œ--net=none
> - å…¶ä»–å®¹å™¨æ¨¡å¼ï¼ˆå³ container æ¨¡å¼ï¼‰ï¼Œ--net=container:NAME_or_ID
> - ç”¨æˆ·è‡ªå®šä¹‰ï¼šdocker 1.9 ç‰ˆæœ¬ä»¥åæ–°å¢çš„ç‰¹æ€§
>
> [äº†è§£æ›´å¤š](https://blog.csdn.net/ithaibiantingsong/article/details/81386307)

---

> **Dockerfile**ï¼šæ˜“äºè‡ªåŠ¨åŒ–çš„å‘½ä»¤ï¼ŒåŒ…å«åˆ›å»ºé•œåƒæ‰€éœ€çš„å…¨éƒ¨æŒ‡ä»¤ï¼ŒåŸºäº dockerfile ä¸­çš„æŒ‡ä»¤ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ `$ docker build` å‘½ä»¤æ¥åˆ›å»ºé•œåƒï¼Œé€šè¿‡å‡å°‘é•œåƒå’Œå®¹å™¨çš„åˆ›å»ºè¿‡ç¨‹æ¥ç®€åŒ–éƒ¨ç½²ã€‚è¯­æ³•å‘½ä»¤ï¼š
>
> - INSTRUCTION argument æŒ‡ä»¤ä¸åŒºåˆ†å¤§å°å†™ï¼Œä½†å‘½åçº¦å®šä¸ºå…¨éƒ¨å¤§å†™
> - FROM
>   - æ ¼å¼ä¸º `FROM <image>`æˆ–`FROM <image>:<tag>`
>   - ç¬¬ä¸€æ¡æŒ‡ä»¤å¿…é¡»ä¸º `FROM` æŒ‡ä»¤ã€‚å¹¶ä¸”ï¼Œå¦‚æœåœ¨åŒä¸€ä¸ª Dockerfile ä¸­åˆ›å»ºå¤šä¸ªé•œåƒæ—¶ï¼Œå¯ä»¥ä½¿ç”¨å¤šä¸ª `FROM` æŒ‡ä»¤ï¼ˆæ¯ä¸ªé•œåƒä¸€æ¬¡ï¼‰
> - MAINTAINER
>   - æ ¼å¼ä¸º `MAINTAINER <name>`ï¼ŒæŒ‡å®šç»´æŠ¤è€…ä¿¡æ¯
> - RUN
>   - æ ¼å¼ä¸º `RUN <command>` æˆ– `RUN ["executable", "param1", "param2"]`
>   - å‰è€…å°†åœ¨ shell ç»ˆç«¯ä¸­è¿è¡Œå‘½ä»¤ï¼Œå³ `/bin/sh -c`ï¼›åè€…åˆ™ä½¿ç”¨ `exec` æ‰§è¡Œã€‚æŒ‡å®šä½¿ç”¨å…¶å®ƒç»ˆç«¯å¯ä»¥é€šè¿‡ç¬¬äºŒç§æ–¹å¼å®ç°ï¼Œä¾‹å¦‚ `RUN ["/bin/bash", "-c", "echo hello"]`
>   - æ¯æ¡ `RUN` æŒ‡ä»¤å°†åœ¨å½“å‰é•œåƒåŸºç¡€ä¸Šæ‰§è¡ŒæŒ‡å®šå‘½ä»¤ï¼Œå¹¶æäº¤ä¸ºæ–°çš„é•œåƒã€‚å½“å‘½ä»¤è¾ƒé•¿æ—¶å¯ä»¥ä½¿ç”¨ \ æ¥æ¢è¡Œ
> - CMD
>   - `CMD ["executable","param1","param2"]` ä½¿ç”¨ `exec` æ‰§è¡Œï¼Œæ¨èæ–¹å¼
>   - `CMD command param1 param2` åœ¨ `/bin/sh` ä¸­æ‰§è¡Œï¼Œæä¾›ç»™éœ€è¦äº¤äº’çš„åº”ç”¨
>   - `CMD ["param1","param2"]` æä¾›ç»™ `ENTRYPOINT` çš„é»˜è®¤å‚æ•°
>   - æŒ‡å®šå¯åŠ¨å®¹å™¨æ—¶æ‰§è¡Œçš„å‘½ä»¤ï¼Œæ¯ä¸ª Dockerfile åªèƒ½æœ‰ä¸€æ¡ `CMD` å‘½ä»¤ã€‚å¦‚æœæŒ‡å®šäº†å¤šæ¡å‘½ä»¤ï¼Œåªæœ‰æœ€åä¸€æ¡ä¼šè¢«æ‰§è¡Œ
>   - å¦‚æœç”¨æˆ·å¯åŠ¨å®¹å™¨æ—¶å€™æŒ‡å®šäº†è¿è¡Œçš„å‘½ä»¤ï¼Œåˆ™ä¼šè¦†ç›–æ‰ `CMD` æŒ‡å®šçš„å‘½ä»¤
> - EXPOSE
>   - æ ¼å¼ä¸º `EXPOSE <port> [<port>...]`
>   - å‘Šè¯‰ Docker æœåŠ¡ç«¯å®¹å™¨æš´éœ²çš„ç«¯å£å·ï¼Œä¾›äº’è”ç³»ç»Ÿä½¿ç”¨ã€‚åœ¨å¯åŠ¨å®¹å™¨æ—¶éœ€è¦é€šè¿‡ -Pï¼ŒDocker ä¸»æœºä¼šè‡ªåŠ¨åˆ†é…ä¸€ä¸ªç«¯å£è½¬å‘åˆ°æŒ‡å®šçš„ç«¯å£
> - ENV
>   - æ ¼å¼ä¸º `ENV <key> <value>`ã€‚ æŒ‡å®šä¸€ä¸ªç¯å¢ƒå˜é‡ï¼Œä¼šè¢«åç»­ `RUN` æŒ‡ä»¤ä½¿ç”¨ï¼Œå¹¶åœ¨å®¹å™¨è¿è¡Œæ—¶ä¿æŒã€‚
> - ADD
>   - æ ¼å¼ä¸º ADD `<src> <dest>`
>   - è¯¥å‘½ä»¤å°†å¤åˆ¶æŒ‡å®šçš„ `<src>` åˆ°å®¹å™¨ä¸­çš„ `<dest>`ã€‚ å…¶ä¸­ `<src>` å¯ä»¥æ˜¯ Dockerfile æ‰€åœ¨ç›®å½•çš„ä¸€ä¸ªç›¸å¯¹è·¯å¾„ï¼›ä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ª URLï¼›è¿˜å¯ä»¥æ˜¯ä¸€ä¸ª tar æ–‡ä»¶ï¼ˆè‡ªåŠ¨è§£å‹ä¸ºç›®å½•ï¼‰
> - COPY
>   - æ ¼å¼ä¸º `COPY <src> <dest>`
>   - å¤åˆ¶æœ¬åœ°ä¸»æœºçš„ `<src>`ï¼ˆä¸º Dockerfile æ‰€åœ¨ç›®å½•çš„ç›¸å¯¹è·¯å¾„ï¼‰åˆ°å®¹å™¨ä¸­çš„ `<dest>`ã€‚å½“ä½¿ç”¨æœ¬åœ°ç›®å½•ä¸ºæºç›®å½•æ—¶ï¼Œæ¨èä½¿ç”¨ `COPY`ï¼Œèƒ½ç”¨ `COPY` çš„æƒ…å†µä¸‹ä¸ç”¨ `ADD`
> - ENTRYPOINT
>   - `ENTRYPOINT ["executable", "param1", "param2"]`
>   - `ENTRYPOINT command param1 param2`ï¼ˆshell ä¸­æ‰§è¡Œï¼‰
>   - é…ç½®å®¹å™¨å¯åŠ¨åæ‰§è¡Œçš„å‘½ä»¤ï¼Œå¹¶ä¸”ä¸å¯è¢« `docker run` æä¾›çš„å‚æ•°è¦†ç›–
>   - æ¯ä¸ª Dockerfile ä¸­åªèƒ½æœ‰ä¸€ä¸ª `ENTRYPOINT`ï¼Œå½“æŒ‡å®šå¤šä¸ªæ—¶ï¼Œåªæœ‰æœ€åä¸€ä¸ªèµ·æ•ˆ
> - VOLUME
>   - æ ¼å¼ä¸º `VOLUME ["/data"]`
>   - åˆ›å»ºä¸€ä¸ªå¯ä»¥ä»æœ¬åœ°ä¸»æœºæˆ–å…¶ä»–å®¹å™¨æŒ‚è½½çš„æŒ‚è½½ç‚¹ï¼Œä¸€èˆ¬ç”¨æ¥å­˜æ”¾æ•°æ®åº“å’Œéœ€è¦ä¿æŒçš„æ•°æ®ç­‰
> - USER
>   - æ ¼å¼ä¸º `USER daemon`
>   - æŒ‡å®šè¿è¡Œå®¹å™¨æ—¶çš„ç”¨æˆ·åæˆ– UIDï¼Œåç»­çš„ `RUN` ä¹Ÿä¼šä½¿ç”¨æŒ‡å®šç”¨æˆ·
>   - å½“æœåŠ¡ä¸éœ€è¦ç®¡ç†å‘˜æƒé™æ—¶ï¼Œå¯ä»¥é€šè¿‡è¯¥å‘½ä»¤æŒ‡å®šè¿è¡Œç”¨æˆ·ã€‚å¹¶ä¸”å¯ä»¥åœ¨ä¹‹å‰åˆ›å»ºæ‰€éœ€è¦çš„ç”¨æˆ·ï¼Œä¾‹å¦‚ï¼š`RUN groupadd -r postgres && useradd -r -g postgres postgres`ã€‚è¦ä¸´æ—¶è·å–ç®¡ç†å‘˜æƒé™å¯ä»¥ä½¿ç”¨ `gosu`ï¼Œè€Œä¸æ¨è `sudo`
> - WORKDIR
>
>   - æ ¼å¼ä¸º `WORKDIR /path/to/workdir`
>   - ä¸ºåç»­çš„ RUNã€CMDã€ENTRYPOINT æŒ‡ä»¤é…ç½®å·¥ä½œç›®å½•
>   - å¯ä»¥ä½¿ç”¨å¤šä¸ª WORKDIR æŒ‡ä»¤ï¼Œåç»­å‘½ä»¤å¦‚æœå‚æ•°æ˜¯ç›¸å¯¹è·¯å¾„ï¼Œåˆ™ä¼šåŸºäºä¹‹å‰å‘½ä»¤æŒ‡å®šçš„è·¯å¾„ã€‚ä¾‹å¦‚ï¼š
>   - `WORKDIR /a`
>   - `WORKDIR b`
>   - `WORKDIR c`
>
>     åˆ™æœ€ç»ˆè·¯å¾„ä¸º /a/b/c
>
> - ONBUILD
>
>   - æ ¼å¼ä¸º `ONBUILD [INSTRUCTION]`
>   - é…ç½®å½“æ‰€åˆ›å»ºçš„é•œåƒä½œä¸ºå…¶å®ƒæ–°åˆ›å»ºé•œåƒçš„åŸºç¡€é•œåƒæ—¶ï¼Œæ‰€æ‰§è¡Œçš„æ“ä½œæŒ‡ä»¤
>   - ä¾‹å¦‚ï¼ŒDockerfile ä½¿ç”¨å¦‚ä¸‹çš„å†…å®¹åˆ›å»ºäº†é•œåƒ `image-A`ï¼š
>
>           [...]
>           ONBUILD ADD . /app/src
>           ONBUILD RUN /usr/local/bin/node-build --dir /app/src
>           [...]
>
>     å¦‚æœåŸºäº image-A åˆ›å»ºæ–°çš„é•œåƒæ—¶ï¼Œæ–°çš„ Dockerfile ä¸­ä½¿ç”¨ FROM image-A æŒ‡å®šåŸºç¡€é•œåƒæ—¶ï¼Œä¼šè‡ªåŠ¨æ‰§è¡Œ ONBUILD æŒ‡ä»¤å†…å®¹ï¼Œç­‰ä»·äºåœ¨åé¢æ·»åŠ äº†ä¸¤æ¡æŒ‡ä»¤ï¼š
>
>           FROM image-A
>
>           #Automatically run the following
>           ADD . /app/src
>           RUN /usr/local/bin/node-build --dir /app/src
>
>     ä½¿ç”¨ `ONBUILD` æŒ‡ä»¤çš„é•œåƒï¼Œæ¨èåœ¨æ ‡ç­¾ä¸­æ³¨æ˜ï¼Œä¾‹å¦‚ `ruby:1.9-onbuild`
>
> ç¼–å†™å®Œæˆ Dockerfile ä¹‹åï¼Œå¯ä»¥é€šè¿‡ `$ docker build` å‘½ä»¤æ¥åˆ›å»ºé•œåƒ
>
> - åŸºæœ¬çš„æ ¼å¼ä¸º `$ docker build [é€‰é¡¹] è·¯å¾„`ï¼Œè¯¥å‘½ä»¤å°†è¯»å–æŒ‡å®šè·¯å¾„ä¸‹ï¼ˆåŒ…æ‹¬å­ç›®å½•ï¼‰çš„ Dockerfileï¼Œå¹¶å°†è¯¥è·¯å¾„ä¸‹æ‰€æœ‰å†…å®¹å‘é€ç»™ Docker æœåŠ¡ç«¯ï¼Œç”±æœåŠ¡ç«¯æ¥åˆ›å»ºé•œåƒã€‚å› æ­¤ä¸€èˆ¬å»ºè®®æ”¾ç½® Dockerfile çš„ç›®å½•ä¸ºç©ºç›®å½•ã€‚ä¹Ÿå¯ä»¥é€šè¿‡ `.dockerignore` æ–‡ä»¶ï¼ˆæ¯ä¸€è¡Œæ·»åŠ ä¸€æ¡åŒ¹é…æ¨¡å¼ï¼‰æ¥è®© Docker å¿½ç•¥è·¯å¾„ä¸‹çš„ç›®å½•å’Œæ–‡ä»¶
> - ä¾‹å¦‚ï¼š`$ docker build -t ${dockerImageName} --force-rm -f ./Dockerfile .`

=========================================================

ä»¥ä¸Šæ˜¯ä¸€äº›åŸºæœ¬æ¦‚å¿µï¼Œç°åœ¨ ubuntu ä¸‹å¼€å§‹å®‰è£… docker å¹¶å¯åŠ¨ä¸€ä¸ª nginx å®¹å™¨ï¼ˆå…¶å®å¤§å¤šæ•°åœºæ™¯ä¸‹ nginx æ²¡å¿…è¦è·‘åœ¨å®¹å™¨é‡Œï¼Œè¿™é‡Œåªæ˜¯ä¸¾ä¸ªä¾‹å­ï¼‰

=========================================================

```shell
$ cat /etc/issue
Ubuntu 16.04.6 LTS \n \l
```

1. é€šè¿‡ shell å‘½ä»¤å®‰è£…ï¼š

   1. `$ curl -sSL https://get.docker.com/ | sh`
   2. [æ›´å¤šå¹³å°åŠå®‰è£…æ–¹å¼](https://docs.docker.com/install/overview/)

2. æ£€éªŒå®‰è£…ï¼Œæ˜¾ç¤ºç‰ˆæœ¬ä¿¡æ¯ï¼Œè¯´æ˜å·²æˆåŠŸå®‰è£…ï¼š

   ```shell
   $ docker -v
   Docker version 18.09.5, build e8ff056
   ```

   psï¼š`$ docker info`å¯æŸ¥çœ‹æ›´å¤šä¿¡æ¯

3. ä¸‹é¢å¼€å§‹åˆ›å»ºä¸€ä¸ªå®¹å™¨ï¼š

   ```shell
    $ docker runâ¶ \
    -dâ· \
    --name=demoâ¸ \
    -u rootâ¹ \
    -p 8002:80âº \
    -v /var/demo:/var/demoâ» \
    nginx:latestâ¼
   ```

   è¯¥å‘½ä»¤è¡¨ç¤ºï¼šåŸºäº nginx:latest è¿™ä¸ªé•œåƒï¼Œåˆ›å»ºä¸€ä¸ªåç§°ä¸º demo çš„å®¹å™¨ï¼Œå¹¶æŠŠå®¹å™¨å†…éƒ¨çš„ 80 ç«¯å£ä¸å®¿ä¸»æœºä¸Šçš„ 8002 ç«¯å£åšæ˜ å°„ï¼Œä½¿å¾—é€šè¿‡å®¿ä¸»æœº 8002 ç«¯å£çš„æµé‡è½¬å‘åˆ°å®¹å™¨å†…éƒ¨çš„ 80 ç«¯å£ä¸Š

   > â¶ï¼š`run` æ–°å»ºå¹¶å¯åŠ¨å®¹å™¨ï¼Œ[æ›´å¤šé€‰é¡¹](https://docs.docker.com/engine/reference/commandline/run/)ï¼Œå…¶æ ‡å‡†è¿‡ç¨‹ï¼š
   >
   > - æ£€æŸ¥æœ¬åœ°æ˜¯å¦å­˜åœ¨æŒ‡å®šçš„é•œåƒï¼Œä¸å­˜åœ¨å°±ä»å…¬æœ‰ä»“åº“ä¸‹è½½ï¼ˆdocker pull xxxï¼‰
   > - åˆ©ç”¨é•œåƒåˆ›å»ºå¹¶å¯åŠ¨ä¸€ä¸ªå®¹å™¨
   > - åˆ†é…ä¸€ä¸ªæ–‡ä»¶ç³»ç»Ÿï¼Œå¹¶åœ¨åªè¯»çš„é•œåƒå±‚å¤–é¢æŒ‚è½½ä¸€å±‚å¯è¯»å†™å±‚
   > - ä»å®¿ä¸»ä¸»æœºé…ç½®çš„ç½‘æ¡¥æ¥å£ä¸­æ¡¥æ¥ä¸€ä¸ªè™šæ‹Ÿæ¥å£åˆ°å®¹å™¨ä¸­å»
   > - ä»åœ°å€æ± é…ç½®ä¸€ä¸ª ip åœ°å€ç»™å®¹å™¨
   > - æ‰§è¡Œç”¨æˆ·æŒ‡å®šçš„åº”ç”¨ç¨‹åº
   > - æ‰§è¡Œå®Œæ¯•åå®¹å™¨è¢«ç»ˆæ­¢

   ***

   > â·ï¼š`-d` Daemonized æ¨¡å¼ï¼Œä»¥å®ˆæŠ¤æ€å½¢å¼åœ¨åå°è¿è¡Œå®¹å™¨

   ***

   > â¸ï¼š`--name=demo` ä¸ºå®¹å™¨èµ·ä¸€ä¸ªåå­—

   ***

   > â¹ï¼š`-u` æŒ‡å®šå®¹å™¨çš„ç”¨æˆ·

   ***

   > âºï¼š`-p` ç«¯å£æ˜ å°„ï¼Œè§„åˆ™æ˜¯ -p å®¿ä¸»æœºç«¯å£:å®¹å™¨ç«¯å£ï¼Œå¯å¤šæ¬¡ä½¿ç”¨æ˜ å°„å¤šä¸ªç«¯å£

   ***

   > â»ï¼š`-v` æŒ‚è½½æ•°æ®å·ï¼Œè§„åˆ™æ˜¯ -v å®¿ä¸»æœºç›®å½•:å®¹å™¨ç›®å½•ï¼Œå¯å¤šæ¬¡ä½¿ç”¨æŒ‚è½½å¤šä¸ªæ•°æ®å·

   ***

   > â¼ï¼šé•œåƒåï¼Œè¯¥å®¹å™¨æ‰€ç”¨çš„é•œåƒåï¼Œå¯é€šè¿‡ `$ docker images` æŸ¥çœ‹æœ¬åœ°é•œåƒ

4. æŸ¥çœ‹æ­£åœ¨è¿è¡Œçš„å®¹å™¨ï¼š

   ```shell
   $ docker ps
   CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                         NAMES
   c24cfee8226a        nginx:latest        "nginx -g 'daemon ofâ€¦"   6 minutes ago       Up 6 minutes        0.0.0.0:8002->80/tcp          demo
   ```

   psï¼š`$ docker ps -a`æŸ¥çœ‹æ‰€æœ‰å®¹å™¨ï¼ˆåŒ…æ‹¬æ­£åœ¨è¿è¡Œçš„ã€å·²åœæ­¢çš„ï¼‰

   > ç°åœ¨è®¿é—®å®¿ä¸»æœºçš„ 8002 ç«¯å£ï¼ˆå®‰å…¨ç»„å¼€é€šï¼‰ï¼Œå³å¯çœ‹åˆ° nginx çš„æ¬¢è¿é¡µé¢ï¼š

   ![nginx:welcom](https://user-gold-cdn.xitu.io/2019/4/28/16a63089f495a2ff?w=1074&h=379&f=jpeg&s=57111)

5. è¿›å…¥å®¹å™¨ï¼š

   æ‰§è¡Œ `$ docker exec -it demo bash` ï¼Œdemo ä¹Ÿå¯ä»¥æ¢æˆå®¹å™¨çš„ id å³ï¼š`$ docker exec -it c24cfee8226a bash`
   ![shell](https://user-gold-cdn.xitu.io/2019/4/28/16a6307d3824742d?w=1512&h=396&f=jpeg&s=72682)

   åœ¨å®¹å™¨å†…å¯æ‰§è¡Œ `$ netstat -lntp` æŸ¥çœ‹ç«¯å£ä½¿ç”¨æƒ…å†µï¼š

   ```shell
    Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name
    tcp        0      0 0.0.0.0:80              0.0.0.0:*               LISTEN      1/nginx: master pro
   ```

   è‹¥å‘ç° netstat not foundï¼Œå…ˆæ‰§è¡Œ `$ apt update && apt install net-tools`

   æ‰§è¡Œ `$ exit` é€€å‡ºå®¹å™¨

   psï¼š

   - `$ docker inspect demo` å¯ä»¥æŸ¥çœ‹è¯¥å®¹å™¨æ›´å¤šä¿¡æ¯
   - `$ docker stop å®¹å™¨å/id` ç»ˆæ­¢å®¹å™¨
   - `$ docker rm å®¹å™¨å/id` åˆ é™¤æœªè¿è¡Œçš„å®¹å™¨
   - `$ docker rmi é•œåƒå/id` åˆ é™¤æœªå ç”¨ï¼ˆæ— å®¹å™¨æ­£åœ¨è¿è¡Œï¼‰çš„é•œåƒ
   - `$ docker rmi $(docker images -f "dangling=true" -q)` æ‰¹é‡åˆ é™¤ä¸º `none`ï¼ˆæ— å®¹å™¨æ­£åœ¨è¿è¡Œï¼‰çš„é•œåƒ

ã€å‚è€ƒã€‘ï¼š

1. <https://www.kancloud.cn/kancloud/docker-guide/220859>
2. <http://leilux.github.io/lou/docker_practice/introduction/README.html>
3. <https://docs.docker.com>
4. <https://blog.csdn.net/ithaibiantingsong/article/details/81386307>

===ğŸ§ğŸ§ _æ–‡ä¸­ä¸è¶³ï¼Œæ¬¢è¿æŒ‡æ­£_ ğŸ¤ªğŸ¤ª===

### æœ€åï¼šä¸‹ä¸€æ¬¡è®²ä¸€ä¸‹ï¼ŒåŸºäº dockerï¼Œæ­å»º ciï¼ˆjenkinsï¼‰æ„å»ºéƒ¨ç½²å‰ç«¯é¡¹ç›®
